<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="chat">
  
  <select id="get" resultType="MemberDto" parameterType="String">
  select * from member where member_id = #{memberId}
  </select>
  
  <insert id="roomCreate" parameterType="RoomDto">
  insert into room values (#{roomNo}, sysdate, null)
  </insert>
  
  
  <insert id="chatUserInsert" parameterType="ChatUserDto">
  insert into chat_user values (#{memberId}, #{roomNo},#{memberName} , #{memberStatus})
  </insert>
  
  <insert id="chatMessageInsert" parameterType="ChatDto">
  insert into chat values (chat_seq.nextval, #{roomNo}, #{memberId}, sysdate, #{chatMessage}, null)
  </insert>
  
  <select id="chatList" parameterType="String" resultType="ChatDto">
  <!-- 번호(roomNo)랑 아이디(memberId)로 채팅 내역을 찾아야함/ 일단은 String (ChatSerchVO를 따로 만들어야하나?)-->
  select * from chat where  room_no = #{roomNo} order by chat_no asc
  </select>
  
  <select id="roomSeqNo" resultType="String" >
	  select room_seq.nextval from dual
	</select>
  
  <select id="searchRoom" parameterType="SearchRoomVO" resultType="String">
  	SELECT room_no FROM chat_user where member_id = #{memberId} 
 		INTERSECT
	SELECT room_no FROM chat_user where member_id = #{trainerId}
  </select>
  
  <select id="chatRoomList" parameterType="String" resultType="ChatUserDto">
  	select * from chat_user CH 
	where CH.room_no in (select room_no from chat_user where member_id = #{memberId})
	and member_status = 'Y'
  </select>
  
	<select id="chatRoom" parameterType="String" resultType="ChatRoomVO">
	select m.member_name, chat.*, mi.files_no from chat chat 
	inner join member_img mi on mi.member_id = chat.member_id 
	inner join member m on m.member_id=chat.member_id
	where room_no = #{roomNo} order by chat_no asc
	</select>
  
  	<select id="searchPartner" parameterType="ChatPartnerSearchVO" resultType="ChatPartnerVO">
  	select cu.member_id,cu.member_name, mi.files_no from chat_user cu inner join member_img mi on mi.member_id = cu.member_id 
	where cu.room_no =#{roomNo} and not cu.member_id =#{memberId}
  	</select>
  
  
  </mapper>