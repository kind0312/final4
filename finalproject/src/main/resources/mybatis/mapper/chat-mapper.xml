<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="chat">
  
  <select id="get" resultType="MemberDto" parameterType="String">
  select * from member where member_id = #{memberId}
  </select>
  
  <insert id="roomCreate" parameterType="RoomDto">
  insert into room values (#{roomNo}, sysdate, null)
  </insert>
  
  
  <insert id="chatUserInsert" parameterType="ChatUserDto">
  insert into chat_user values (#{memberId}, #{roomNo},#{memberName} , #{memberStatus})
  </insert>
  
  <insert id="chatMessageInsert" parameterType="ChatDto">
  insert into chat values (chat_seq.nextval, #{roomNo}, #{memberId}, sysdate, #{chatMessage}, null)
  </insert>
  
  <select id="chatList" parameterType="String" resultType="ChatDto">
  <!-- 번호(roomNo)랑 아이디(memberId)로 채팅 내역을 찾아야함/ 일단은 String (ChatSerchVO를 따로 만들어야하나?)-->
  select * from chat where  room_no = #{roomNo}
  </select>
  
  <select id="roomSeqNo" resultType="String" >
	  select room_seq.nextval from dual
	</select>
  
  <select id="searchRoom" parameterType="SearchRoomVO" resultType="String">
  	SELECT room_no FROM chat_user where member_id = #{memberId} 
 		INTERSECT
	SELECT room_no FROM chat_user where member_id = #{trainerId}
  </select>
  
  <select id="chatRoomList" parameterType="String" resultType="ChatUserDto">
  	select * from chat_user CH 
	where CH.room_no in (select room_no from chat_user where member_id = #{memberId})
	and member_status = 'Y'
  </select>
  
  
  </mapper>