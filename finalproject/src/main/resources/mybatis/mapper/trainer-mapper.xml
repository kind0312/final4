<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="trainer">



	<!-- 훈련사 목록 조회 mapper-->
	  <select id="list" resultType="TrainerListVO">
      select nvl(R.cnt,0) cnt , nvl(CEIL(R.avg),0) avg, T.trainer_no, T.member_id,
      T.trainer_profile, T.trainer_profile_content,
      M.member_name from trainer T
      inner join member M on T.member_id = M.member_id left outer join
      (select trainer_no, count(*) cnt, avg(review_good) avg 
      from review group by trainer_no)
      R on R.trainer_no = T.trainer_no
      </select>
      
      <!-- 훈련사 단일 조회 mapper -->
      <select id="selectOne"  parameterType="String" resultType="TrainerListVO">
      select nvl(R.cnt,0) cnt , nvl(CEIL(R.avg),0) avg, T.trainer_no, T.member_id,
      T.trainer_profile, T.trainer_profile_content,
      M.member_name from trainer T
      inner join member M on T.member_id = M.member_id left outer join
      (select trainer_no, count(*) cnt, avg(review_good) avg 
      from review group by trainer_no)
      R on R.trainer_no = T.trainer_no where T.member_id = #{memberId}
      </select>
      
      <!-- 훈련사 단일 리뷰 조회 -->
      <select id="selectReviewOne" parameterType="int" resultType="ReviewVO">
      select * from review where trainer_no = #{trainerNo}
      </select>
      
      
      
      
      
      <insert id="trainerProfileInsert" parameterType="TrainerDto"> 
      insert into trainer
		(trainer_no, member_id, apply_no, trainer_profile, trainer_profile_content)
		values(trainer_seq.nextval, '#{memberId}', #{applyNo},  #{trainerProfile},
		#{trainerProfileContent})
      </insert>
      
      <!-- 트레이너 자기소개 단일조회 -->
      <select id="selectOnePro" parameterType="String" resultType="TrainerDto">
      select * from trainer where member_id = #{memberId}
      </select>
</mapper>